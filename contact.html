<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Contact â€” 2026 Grand Court of Pennsylvania - Order of the Amaranth">
  <link rel="icon" href="assets/img/favicon.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="assets/css/styles.css?v=contact-v3" /><!-- bump -->
  <title>Contact Us</title>

  <style>
    /* Match home page layout */
    .container {
      text-align: center;
      max-width: 900px;
      margin: 0 auto;
      padding: 1rem;
      color: #1f2937;
    }

    .session-title {
      font-size: 2.8rem;
      font-weight: 900;
      text-align: center;
      line-height: 1.2;
      margin-bottom: 0.4rem;
      color: #1f2937;
    }

    .session-subtitle {
      font-size: 1.4rem;
      font-weight: 600;
      color: #000;
      text-align: center;
      margin-bottom: 1rem;
    }

    .org-intro {
      font-size: 1.1rem;
      font-weight: 500;
      line-height: 1.5;
      margin: 0 auto 1rem;
      color: #333;
      max-width: 700px;
    }

    .hero { padding-bottom: .25rem; }

    .panel {
      margin: .25rem auto 1.25rem;
      border-top: 1px solid transparent;
      text-align: center;
      max-width: 720px;
      background: rgba(255,255,255,0.40);
      border: 1px solid rgba(229,231,235,0.45);
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 2px 10px rgba(0,0,0,.06);
      backdrop-filter: saturate(120%) blur(2px);
      -webkit-backdrop-filter: saturate(120%) blur(2px);
    }

    .panel img {
      display: block;
      margin: 0.5rem auto;
      border-radius: 8px;
    }

    /* Logo area fix (same as home) */
    .logo {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: inherit;
    }
    .logo img {
      display: block;
      width: 80px;
      height: auto;
    }
    .logo span {
      display: block;
      margin-top: 0.25rem;
      font-size: 1.1rem;
      font-weight: 700;
      color: #1f2937;
    }

    /* Contact form specifics */
    .contact-panel {
      text-align: left; /* form fields left-aligned inside the panel */
    }

    .contact-heading {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: .5rem;
      text-align: left;
    }

    form {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.75rem 1rem;
    }
    .field label {
      font-weight: 600;
      display: block;
      margin-bottom: 0.2rem;
    }
    .field input,
    .field select,
    .field textarea {
      width: 100%;
      padding: .45rem .55rem;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font: inherit;
    }
    .field textarea {
      min-height: 120px;
      resize: vertical;
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-top: 0.25rem;
    }

    .btn-primary {
      padding: .55rem 1.2rem;
      border-radius: 999px;
      border: none;
      background: #860000;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-secondary {
      padding: .55rem 1.1rem;
      border-radius: 999px;
      border: 1px solid #6b7280;
      background: #f3f4f6;
      color: #111827;
      font-weight: 600;
      cursor: pointer;
    }

    .status {
      min-height: 1.2em;
      font-size: 0.9rem;
    }
    .status.ok { color:#065f46; }
    .status.err { color:#b91c1c; }

    @media (min-width: 700px) {
      form.two-column { grid-template-columns: 1fr 1fr; }
      .full-width { grid-column: 1 / -1; }
    }

    /* Responsive titles (same as home) */
    @media (max-width: 600px) {
      .session-title { font-size: 2.1rem; }
      .session-subtitle { font-size: 1.2rem; }
    }
  </style>
</head>

<body>
  <!-- Wallpaper -->
  <div class="wallpaper" style="--wallpaper: url('/assets/img/wallpaper.jpg')"></div>

  <!-- Header / Nav (same structure as home, but Contact as current) -->
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="home.html">
        <img src="assets/img/logo.svg" alt="Logo">
        <span>Order of the Amaranth</span>
      </a>
      <nav class="site-nav nav">
        <a href="home.html">Home</a>
        <a href="banquet.html">Banquets</a>
        <a href="supreme-addons.html">Supreme Council Add-Ons</a>
        <!-- <a href="product-catalog.html" data-catalog-link>Product Catalog</a> -->

        <!-- TEMP: hide Supplies everywhere (weâ€™ll re-enable later) -->
        <!-- <a href="supplies.html" data-cat-link data-cat="supplies">Supplies</a> -->

        <!-- <a href="charity.html" data-cat-link data-cat="charity">Charity</a> -->

        <a href="order.html">Cart</a>
        <span class="nav-current">Contact</span>
      </nav>
    </div>
  </header>

  <!-- Main Content (mirrors home layout, but with contact info) -->
  <main class="container mt-lg">
    <h1 class="session-title">
      2026 Grand Court of Pennsylvania<br>
      Order of the Amaranth
    </h1>
    <h2 class="session-subtitle">Adventure Is Out There</h2>

    <p class="org-intro">
      If you have questions about registrations, banquets, Grand Court add-ons,
      or general session details, please use the form below and we will respond as soon as possible.
    </p>

    <section class="panel contact-panel" id="contact">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem;">
        <div class="contact-heading">Contact the Session Committee</div>
        <button type="button" class="btn-secondary" onclick="history.back()">Back</button>
      </div>

      <form id="contact-form" class="two-column" novalidate>
        <div class="field">
          <label for="cf-name">Your Name *</label>
          <input id="cf-name" name="name" type="text" required />
        </div>

        <div class="field">
          <label for="cf-email">Email Address *</label>
          <input id="cf-email" name="email" type="email" required />
        </div>

        <div class="field">
          <label for="cf-phone">Phone (optional)</label>
          <input id="cf-phone" name="phone" type="tel" />
        </div>

        <div class="field">
          <label for="cf-topic">What is this about? *</label>
          <select id="cf-topic" name="topic" required>
            <option value="">Chooseâ€¦</option>
            <option value="banquets">Banquets / meal choices</option>
            <option value="addons">Grand Court add-ons</option>
            <!-- <option value="catalog">Product catalog</option> -->
            <option value="order">Order / checkout issues</option>
            <option value="website">Website problem</option>
            <option value="general">General question</option>
          </select>
        </div>

        <div class="field">
          <label for="cf-page">Which page were you on? (optional)</label>
          <select id="cf-page" name="page">
            <option value="">Not sure / Other</option>
            <option value="home">Home</option>
            <option value="banquet">Banquets</option>
            <option value="addons">Grand Court Add-Ons</option>
            <!-- <option value="catalog">Product Catalog</option> -->
            <option value="order">Order</option>
          </select>
        </div>

        <div class="field">
          <label for="cf-item">Item name or ID (optional)</label>
          <input id="cf-item" name="item" type="text" />
        </div>

        <div class="field full-width">
          <label for="cf-message">Your Message *</label>
          <textarea id="cf-message" name="message" required></textarea>
        </div>

        <div class="actions full-width">
          <button type="submit" class="btn-primary" id="cf-submit">Send Message</button>
          <div class="status" id="cf-status"></div>
        </div>
      </form>
    </section>

    <!-- âœ… changed: this is now driven by EMAIL_CONTACT (via router settings effective.REPLY_TO) -->
    <p class="org-intro" style="font-size:0.95rem;">
      Prefer email instead of the form?
      <br>
      <span id="contact-email-slot" style="opacity:.75;">Loading contact emailâ€¦</span>
    </p>
  </main>

  <footer class="site-footer">
    
    <div class="container">
      <nav class="site-nav nav footer-nav">
        <a href="home.html">Home</a>
        <a href="banquet.html">Banquets</a>
        <a href="grand-court-addons.html">Grand Court Add-Ons</a>
        <!-- <a href="product-catalog.html" data-catalog-link>Product Catalog</a> -->

        <!-- TEMP: hide Supplies everywhere (weâ€™ll re-enable later) -->
        <!-- <a href="supplies.html" data-cat-link data-cat="supplies">Supplies</a> -->

        <!-- <a href="charity.html" data-cat-link data-cat="charity">Charity</a> -->

        <a href="order.html">Cart</a>
        <span class="nav-current">Contact</span>
      </nav>
    </div>

    <div class="container tiny">Â© 2025 Order of the Amaranth</div>
  </footer>

  <script src="assets/js/main.js" defer></script>

  <!-- Hide Product Catalog link if no visible items (same logic as home) -->
  <script>
  (async function(){
    const link = document.querySelector('[data-catalog-link]');
    if (!link) return;

    async function fetchJson(url){
      try {
        const r = await fetch(url, { cache: 'no-store' });
        if (!r.ok) return null;
        return await r.json();
      } catch(e){ return null; }
    }

    let items = [];
    // Only use the supported endpoint; your router exposes ?type=products
    let j = await fetchJson('/api/router?type=products');
    if (Array.isArray(j?.products)) items = j.products;

    // Fallback to embedded list if present
    if (!items.length && Array.isArray(window.CATALOG_ITEMS)) items = window.CATALOG_ITEMS;

    const now = Date.now();
    const hasVisible = (items || []).some(i => {
      if (!i || i.active === false) return false;
      const s = i.publishStart ? Date.parse(i.publishStart) : null;
      const e = i.publishEnd   ? Date.parse(i.publishEnd)   : null;
      return (s == null || now >= s) && (e == null || now <= e);
    });

    if (!hasVisible) link.style.display = 'none';
  })();
  </script>

  <!-- Maintenance check (same as home) -->
  <script>
  (async () => {
    try {
      const resp = await fetch('/api/router?type=settings', { cache: 'no-store' });
      if (!resp.ok) throw new Error('settings not available');
      const data = await resp.json();

      const on  = data?.effective?.MAINTENANCE_ON ?? data?.MAINTENANCE_ON;
      const msg = data?.effective?.MAINTENANCE_MESSAGE ?? data?.MAINTENANCE_MESSAGE;

      if (on === 'true' || on === true) {
        document.body.innerHTML = `
          <div style="display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;background:#fef2f2;color:#b91c1c;font-family:sans-serif;text-align:center;padding:20px">
            <h1 style="font-size:2em;margin-bottom:12px;">ðŸ›  Under Maintenance</h1>
            <p style="font-size:1.2em;max-width:500px;">
              ${msg || 'The site is temporarily unavailable. Please check back soon.'}
            </p>
          </div>
        `;
      }
    } catch (err) {
      console.error('Maintenance check failed:', err);
    }
  })();
  </script>

  <!-- âœ… NEW: populate the "Prefer email" line from EMAIL_CONTACT via settings -->
  <script>
  (async function(){
    const slot = document.getElementById('contact-email-slot');
    if (!slot) return;

    const esc = (s) => String(s || "").replace(/</g, "&lt;").replace(/"/g, "&quot;");

    try {
      const r = await fetch('/api/router?type=settings', { cache: 'no-store' });
      if (!r.ok) throw new Error('settings fetch failed');
      const j = await r.json().catch(() => ({}));

      // Your router returns effective settings; REPLY_TO should be backed by EMAIL_CONTACT
      const email =
        (j && j.effective && j.effective.REPLY_TO) ||
        j.REPLY_TO ||
        '';

      const e = String(email || '').trim();
      if (!e) {
        slot.textContent = 'Please use the form above.';
        slot.style.opacity = '1';
        return;
      }

      slot.innerHTML = `<a href="mailto:${esc(e)}">${esc(e)}</a>`;
      slot.style.opacity = '1';
    } catch (err) {
      // fail closed-ish: don't expose any old/stale address
      slot.textContent = 'Please use the form above.';
      slot.style.opacity = '1';
    }
  })();
  </script>

  <!-- Contact form JS -->
  <script>
  (function(){
    const form   = document.getElementById('contact-form');
    const btn    = document.getElementById('cf-submit');
    const status = document.getElementById('cf-status');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      status.textContent = '';
      status.className = 'status';

      const data = {
        name:    form.name.value.trim(),
        email:   form.email.value.trim(),
        phone:   form.phone.value.trim(),
        topic:   form.topic.value,
        page:    form.page.value,
        item:    form.item.value.trim(),
        message: form.message.value.trim()
      };

      if (!data.name || !data.email || !data.topic || !data.message) {
        status.textContent = 'Please fill in all required fields.';
        status.classList.add('err');
        return;
      }

      btn.disabled = true;

      try {
        const resp = await fetch('/api/router?action=contact_form', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const j = await resp.json().catch(() => ({}));

        if (!resp.ok || j.ok === false) throw 0;

        status.textContent = 'Thank you! Your message has been sent.';
        status.classList.add('ok');
        form.reset();
      } catch {
        status.textContent = 'Message failed to send. Please try again.';
        status.classList.add('err');
      } finally {
        btn.disabled = false;
      }
    });
  })();
  </script>

  <script>
  (async function(){
    async function hasActive(cat){
      try{
        const r = await fetch("/api/router?type=catalog_has_active&cat=" + encodeURIComponent(cat), { cache: "no-store" });
        if (!r.ok) return true;
        const j = await r.json();
        return !!(j && j.hasActive);
      }catch(e){
        // fail open: show links if API fails
        return true;
      }
    }
    const links = Array.from(document.querySelectorAll("[data-cat-link][data-cat]"));
    for (const a of links){
      const cat = a.getAttribute("data-cat") || "";
      const ok = await hasActive(cat);
      if (!ok) a.style.display = "none";
    }
  })();
  </script>
  <script src="/assets/js/visits.js?v=visits-v1"></script>

  <!-- Visitor tracking -->
  <script>
  (function () {
    try {
      const path = location.pathname;
      if (
        path.startsWith('/admin') ||
        path.includes('debug') ||
        path.startsWith('/api') ||
        path.startsWith('/assets')
      ) return;

      fetch(`/api/router?type=track_visit&path=${encodeURIComponent(path)}`, {
        method: 'GET',
        keepalive: true
      });
    } catch (e) {}
  })();
  </script>

</body>
</html>
