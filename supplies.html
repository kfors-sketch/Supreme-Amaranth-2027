<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Supplies â€“ Supreme Council price list items." />
  <meta name="robots" content="noindex, nofollow" />
  <link rel="icon" href="assets/img/favicon.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="assets/css/styles.css?v=supplies-v3.1" /><!-- bump -->
  <title>Supplies</title>
</head>

<body data-page="supplies">
  <div class="wallpaper" style="--wallpaper: url('/assets/img/wallpaper.jpg')"></div>

  <!-- Header / Logo + Nav -->
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="home.html">
        <img src="assets/img/logo.svg" alt="Logo" />
      </a>
      <span class="site-title">Order of the Amaranth</span>
      <nav class="site-nav nav">
        <a href="home.html">Home</a>
        <a href="banquet.html">Banquets</a>
        <a href="supreme-addons.html">Supreme Council Add-Ons</a>
        <a href="product-catalog.html">Product Catalog</a>
        <span class="nav-current">Supplies</span>
        <a href="order.html">Cart</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <main class="container mt-lg">
    <div class="sup-header">
      <h1>Supplies</h1>

<section class="card page-instructions" style="margin-top:16px;">
  <h3>Before You Begin</h3>
  <p>Supplies are <strong>year-round purchases</strong> and are tied to the <strong>purchaser</strong>, not to attendees.</p>
  <p>Select items and quantities, then complete purchaser information on the <strong>Order</strong> page.</p>
</section>

      <p class="muted sup-sub">
        Supreme Council Order of the Amaranth â€” Price List 2026
      </p>
    </div>

    <!-- Empty-state (shown when master publish is off or nothing visible) -->
    <div id="emptyCatalog" class="card sup-empty" style="display:none;">
      <h2 style="margin:.25rem 0 .5rem;">Supplies are not available right now</h2>
      <p class="muted" style="margin:0">
        Please check back soon.
      </p>
    </div>

    <!-- Notes (optional; auto-hide when empty) -->
    <div id="supNotes" class="card sup-notes" style="display:none;"></div>

    <!-- PDF-style list -->
    <section id="supList" class="sup-list" aria-live="polite"></section>
  </main>

  <footer class="site-footer">
    
    <div class="container">
      <nav class="site-nav nav footer-nav">
        <a href="home.html">Home</a>
        <a href="banquet.html">Banquets</a>
        <a href="grand-court-addons.html">Grand Court Add-Ons</a>
        <a href="product-catalog.html">Product Catalog</a>
        <span class="nav-current">Supplies</span>
        <a href="order.html">Cart</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>

    <div class="container tiny">Â© 2025</div>
  </footer>

  <!-- Core site scripts (order matters) -->
  <script src="assets/js/site-settings.js"></script>
  <script src="assets/js/supplies.js?v=2025-12-17a"></script><!-- bump -->
  <script src="assets/js/cart.js"></script>
  <script src="assets/js/site-boot.js"></script>

  <!-- âœ… HARD GATE: Hide Supplies page unless explicitly enabled (or admin/preview) -->
  <script>
    function isPreviewMode(){
      try {
        const u = new URL(window.location.href);
        return (u.searchParams.get('preview') === '1');
      } catch (_) {
        return false;
      }
    }

    function hasAdminToken(){
      // Your admin token is stored here per your setup.
      try {
        return !!(window.localStorage && localStorage.getItem('amaranth_report_token'));
      } catch (_) {
        return false;
      }
    }

    // Page is reachable if:
    // - preview=1 OR admin token OR supplies.js set window.SUPPLIES_ACTIVE = true
    const PAGE_ALLOWED = !!(isPreviewMode() || hasAdminToken() || window.SUPPLIES_ACTIVE === true);

    if (!PAGE_ALLOWED) {
      window.location.replace("home.html");
    }
  </script>

  <!-- Page logic -->
  <script>
    /* =======================
       Gate (PREVIEW / ADMIN)
       ======================= */

    // MASTER VIEW: only for preview=1 or admin token.
    // This controls whether the *list renders* at all.
    const MASTER_SUPPLIES_ON = (isPreviewMode() || hasAdminToken());

    /* =======================
       Helpers
       ======================= */
    function money(n){
      const v = Math.round(Number(n) * 100) / 100;
      return v.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 });
    }

    function normalizePrice(p){
      const n = Number(p);
      if (!isFinite(n)) return 0;
      // Treat 0<n<1 as cents accidentally stored
      return (n > 0 && n < 1) ? Math.round(n * 100) : n;
    }

    function escHtml(s){
      return String(s || '').replace(/[&<>"]/g, c => (
        c === '&' ? '&amp;'
        : c === '<' ? '&lt;'
        : c === '>' ? '&gt;'
        : '&quot;'
      ));
    }

    function parseDate(d){
      if (!d) return null;
      if (typeof d === 'number') return new Date(d);
      const s = String(d).trim();
      if (!s) return null;
      if (/^\d{4}-\d{2}-\d{2}$/.test(s)) return new Date(s + 'T00:00:00');
      const t = Date.parse(s);
      return isNaN(t) ? null : new Date(t);
    }

    function isWithinWindow(item, now){
      const start = parseDate(item.publishStart);
      const end   = parseDate(item.publishEnd);
      if (start && now < start) return false;
      if (end && now > end)     return false;
      return true;
    }

    // SHOW ALL ITEMS (priced + request-only) as long as master view is on.
    // Ordering is controlled separately.
    function isVisibleItem(item){
      if (!MASTER_SUPPLIES_ON) return false;
      if (!item) return false;
      return true;
    }

    // Keep PDF order: use original array order; group by category in order first seen
    function groupByCategoryPreserveOrder(items){
      const map = new Map();
      items.forEach(it=>{
        const cat = String(it.category || 'Other');
        if (!map.has(cat)) map.set(cat, []);
        map.get(cat).push(it);
      });
      return map;
    }

    function isRequestOnly(item){
      return !!(item && (item.priceText || (Number(item.price || 0) === 0 && item.active === false && item.description)));
    }

    function getPriceLabel(item){
      const price = normalizePrice(item.price || 0);
      if (price > 0) return money(price);
      return escHtml(item.priceText || 'Available upon request');
    }

    function buildQtyOptions(){
      const opts = [1,2,3,4,5,6,7,8,9,10,12,15,20,25,30,50,75,100];
      return opts.map(n=>`<option value="${n}">${n}</option>`).join('');
    }

    function openModal(modalEl){
      modalEl.classList.add('open');
      modalEl.setAttribute('aria-hidden', 'false');
      const first = modalEl.querySelector('input,textarea,select,button');
      if (first) setTimeout(()=>first.focus(), 20);
      document.body.classList.add('modal-open');
    }

    function closeModal(modalEl){
      modalEl.classList.remove('open');
      modalEl.setAttribute('aria-hidden', 'true');
      document.body.classList.remove('modal-open');
    }

    function setText(el, txt){ if (el) el.textContent = String(txt || ''); }

    document.addEventListener('DOMContentLoaded', async () => {
      if (MASTER_SUPPLIES_ON && window.Cart && typeof Cart.load === 'function') Cart.load();

      const listEl  = document.getElementById('supList');
      const emptyEl = document.getElementById('emptyCatalog');
      const notesEl = document.getElementById('supNotes');

      const now = new Date();

      if (!MASTER_SUPPLIES_ON){
        listEl.innerHTML = '';
        emptyEl.style.display = '';
        notesEl.style.display = 'none';
        return;
      }

      // 1) Load items (KV first, then static)
      let rawItems = [];
      try {
        const resp = await fetch('/api/router?type=catalog_items&cat=supplies', { cache: 'no-store' });
        if (resp.ok){
          const data = await resp.json();
          if (Array.isArray(data.items) && data.items.length) rawItems = data.items;
        }
      } catch (_) {}

      if (!rawItems.length) rawItems = (window.SUPPLIES_ITEMS || []);

      // 2) Show all items (request-only + priced)
      const visible = (rawItems || []).filter(it => isVisibleItem(it));

      // Notes
      const packaging = Number(window.SUPPLIES_PACKAGING_FEE_CENTS || 0);
      const noteLines = [];
      if (packaging > 0) noteLines.push('Packaging: minimum ' + money(packaging / 100) + ' packaging charge may apply.');

      if (noteLines.length){
        notesEl.style.display = '';
        notesEl.innerHTML = `
          <div class="sup-notes-title">Notes</div>
          <ul class="sup-notes-list">
            ${noteLines.map(x => `<li>${escHtml(x)}</li>`).join('')}
          </ul>
        `;
      } else {
        notesEl.style.display = 'none';
      }

      if (!visible.length){
        listEl.innerHTML = '';
        emptyEl.style.display = '';
        return;
      }
      emptyEl.style.display = 'none';

      // 3) Render grouped list in TWO-COLUMN PDF ROWS
      const grouped = groupByCategoryPreserveOrder(visible);
      const qtyOptionsHTML = buildQtyOptions();

      function renderItemCell(item){
        if (!item) return `<div class="sup-cell sup-cell-empty"></div>`;

        const price = normalizePrice(item.price || 0);

        const canOrder = (
          window.Cart &&
          typeof Cart.addLine === 'function' &&
          item.active === true &&
          isWithinWindow(item, now) &&
          price > 0
        );

        const reqOnly = isRequestOnly(item) || (price <= 0 && item.active === false);

        const desc = (item.description || item.notes || '').trim();
        const descHtml = desc ? `<div class="sup-desc">${escHtml(desc)}</div>` : ``;

        let controls = '';
        if (canOrder){
          controls = `
            <div class="sup-controls">
              <label class="sup-qty">
                <span class="sr-only">Qty</span>
                <select class="sup-qtysel" data-id="${escHtml(item.id)}">
                  ${qtyOptionsHTML}
                </select>
              </label>
              <button class="btn btn-primary sup-add" data-id="${escHtml(item.id)}">Add</button>
            </div>
          `;
        } else if (reqOnly){
          controls = `
            <div class="sup-controls">
              <button class="btn btn-outline request-price" data-id="${escHtml(item.id)}">Request Price</button>
            </div>
          `;
        } else {
          controls = `<div class="sup-controls sup-controls-disabled"></div>`;
        }

        const priceLabel = canOrder ? money(price) : getPriceLabel(item);

        return `
          <div class="sup-cell" data-id="${escHtml(item.id)}">
            <div class="sup-cell-top">
              <div class="sup-name">${escHtml(item.name || '')}</div>
              ${descHtml}
            </div>
            <div class="sup-cell-right">
              <span class="sup-price">${priceLabel}</span>
              ${controls}
            </div>
          </div>
        `;
      }

      const html = [];
      for (const [cat, items] of grouped.entries()){
        html.push(`<div class="sup-category">`);
        html.push(`<div class="sup-cat-title">${escHtml(cat)}</div>`);
        html.push(`<div class="sup-table sup-table-2col">`);

        for (let i = 0; i < items.length; i += 2){
          const left = items[i];
          const right = items[i+1] || null;

          html.push(`
            <div class="sup-row sup-row-2col">
              ${renderItemCell(left)}
              ${renderItemCell(right)}
            </div>
          `);
        }

        html.push(`</div></div>`);
      }

      listEl.innerHTML = html.join('');

      /* =======================
         Modals + Actions
         ======================= */
      const quoteModal = document.getElementById('quoteModal');
      const quoteTitle = document.getElementById('quoteItemTitle');
      const quoteCategory = document.getElementById('quoteItemCategory');
      const quoteId = document.getElementById('quoteItemId');
      const quoteForm = document.getElementById('quoteForm');
      const quoteStatus = document.getElementById('quoteStatus');

      const detailsModal = document.getElementById('detailsModal');
      const detailsTitle = document.getElementById('detailsItemTitle');
      const detailsCategory = document.getElementById('detailsItemCategory');
      const detailsId = document.getElementById('detailsItemId');
      const detailsPrice = document.getElementById('detailsItemPrice');
      const detailsForm = document.getElementById('detailsForm');
      const detailsStatus = document.getElementById('detailsStatus');

      let _currentQuoteItem = null;
      let _currentDetailsItem = null;

      // Close handlers
      document.querySelectorAll('[data-modal-close]').forEach(btn=>{
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-modal-close');
          const modal = document.getElementById(id);
          if (modal) closeModal(modal);
        });
      });
      document.querySelectorAll('.modal-backdrop').forEach(bg=>{
        bg.addEventListener('click', () => {
          const id = bg.getAttribute('data-modal');
          const modal = document.getElementById(id);
          if (modal) closeModal(modal);
        });
      });
      document.addEventListener('keydown', (e)=>{
        if (e.key === 'Escape'){
          if (quoteModal.classList.contains('open')) closeModal(quoteModal);
          if (detailsModal.classList.contains('open')) closeModal(detailsModal);
        }
      });

      // Request Price button
      listEl.querySelectorAll('.request-price').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          const item = visible.find(x => String(x.id) === String(id));
          if (!item) return;

          _currentQuoteItem = item;
          setText(quoteTitle, item.name || '');
          setText(quoteCategory, item.category || '');
          setText(quoteId, item.id || '');
          quoteStatus.textContent = '';
          quoteForm.reset();

          openModal(quoteModal);
        });
      });

      // Add button (handles items that require extra info)
      listEl.querySelectorAll('.sup-add').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          const item = visible.find(x => String(x.id) === String(id));
          if (!item) return;

          const price = normalizePrice(item.price || 0);
          const sel = Array.from(listEl.querySelectorAll('.sup-qtysel')).find(x => String(x.dataset.id) === String(id));
          const qty = Math.max(1, parseInt(sel?.value || '1', 10));

          if (item.requiresCourtInfo === true){
            _currentDetailsItem = { item, qty, price };
            setText(detailsTitle, item.name || '');
            setText(detailsCategory, item.category || '');
            setText(detailsId, item.id || '');
            setText(detailsPrice, money(price));
            detailsStatus.textContent = '';
            detailsForm.reset();
            openModal(detailsModal);
            return;
          }

          if (!window.Cart || typeof Cart.addLine !== 'function') {
            alert('Cart is not available yet. Please refresh and try again.');
            return;
          }

          Cart.addLine({
            attendeeId: '(unassigned)',
            itemType: 'catalog:supplies',
            itemId: String(item.id),
            itemName: item.name || 'Item',
            qty,
            unitPrice: price,
            meta: { sku: item.sku || '', note: '', category: item.category || '' }
          });

          alert('Added to order.');
        });
      });

      // Submit quote request
      quoteForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        if (!_currentQuoteItem) return;

        quoteStatus.textContent = 'Sending...';

        const purchaser = {
          name: document.getElementById('q_name').value.trim(),
          email: document.getElementById('q_email').value.trim(),
          phone: document.getElementById('q_phone').value.trim(),
          courtName: document.getElementById('q_court').value.trim(),
          courtNumber: document.getElementById('q_courtno').value.trim(),
        };
        const notes = document.getElementById('q_notes').value.trim();

        try {
          const resp = await fetch('/api/supplies-request-price', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              item: { id: _currentQuoteItem.id, name: _currentQuoteItem.name, category: _currentQuoteItem.category },
              purchaser,
              notes
            })
          });

          const data = await resp.json().catch(()=> ({}));
          if (!resp.ok || data.ok !== true){
            throw new Error(data.error || ('Request failed (' + resp.status + ')'));
          }

          quoteStatus.textContent = 'Sent! We will follow up with pricing.';
          setTimeout(()=> closeModal(quoteModal), 700);
        } catch (err) {
          quoteStatus.textContent = 'Error: ' + (err?.message || String(err));
        }
      });

      // Submit details + add to cart
      detailsForm.addEventListener('submit', (e) => {
        e.preventDefault();
        if (!_currentDetailsItem) return;

        if (!window.Cart || typeof Cart.addLine !== 'function') {
          detailsStatus.textContent = 'Cart is not available. Please refresh and try again.';
          return;
        }

        const item = _currentDetailsItem.item;
        const qty = _currentDetailsItem.qty;
        const price = _currentDetailsItem.price;

        const courtName = document.getElementById('d_court').value.trim();
        const courtNumber = document.getElementById('d_courtno').value.trim();
        const dateOrg = document.getElementById('d_dateorg').value.trim();
        const location = document.getElementById('d_location').value.trim();

        if (!courtName || !courtNumber || !dateOrg || !location){
          detailsStatus.textContent = 'Please fill in all required fields.';
          return;
        }

        const note = `Court: ${courtName} (#${courtNumber}) | Date Organized: ${dateOrg} | Location: ${location}`;

        Cart.addLine({
          attendeeId: '(unassigned)',
          itemType: 'catalog:supplies',
          itemId: String(item.id),
          itemName: item.name || 'Item',
          qty,
          unitPrice: price,
          meta: { sku: item.sku || '', note, category: item.category || '' }
        });

        detailsStatus.textContent = 'Added to order.';
        setTimeout(()=> closeModal(detailsModal), 500);
      });
    });
  </script>

  <style>
    /* PDF-style Supplies Layout (two-column rows) */
    .sup-header{max-width:1100px;margin:0 auto 10px;padding:0 6px;}
    .sup-sub{margin:.15rem 0 0;}

    .sup-empty{max-width:780px;margin:0 auto 16px;padding:16px;}
    .sup-notes{max-width:1100px;margin:0 auto 12px;padding:14px;}
    .sup-notes-title{font-weight:800;margin-bottom:8px;}
    .sup-notes-list{margin:0;padding-left:18px;}
    .sup-notes-list li{margin:6px 0;}

    .sup-list{max-width:1100px;margin:0 auto;padding:0 6px 24px;}
    .sup-category{margin:14px 0 18px;}
    .sup-cat-title{
      font-weight:900;
      letter-spacing:.02em;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(229,231,235,0.55);
      background: rgba(255,255,255,0.55);
      backdrop-filter: saturate(120%) blur(2px);
      -webkit-backdrop-filter: saturate(120%) blur(2px);
    }

    .sup-table{
      margin-top:10px;
      border:1px solid rgba(229,231,235,0.6);
      border-radius:12px;
      overflow:hidden;
      background: rgba(255,255,255,0.40);
      backdrop-filter: saturate(120%) blur(2px);
      -webkit-backdrop-filter: saturate(120%) blur(2px);
    }

    .sup-row-2col{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
      padding:12px;
      border-top:1px solid rgba(229,231,235,0.55);
    }
    .sup-row-2col:first-child{border-top:0;}

    .sup-cell{
      display:flex;
      gap:12px;
      justify-content:space-between;
      align-items:flex-start;
      padding:12px;
      border:1px solid rgba(229,231,235,0.55);
      border-radius:12px;
      background: rgba(255,255,255,0.60);
      min-height:78px;
    }
    .sup-cell-empty{visibility:hidden;}

    .sup-cell-top{flex:1 1 auto;min-width:0;}
    .sup-name{font-weight:800;line-height:1.2;}
    .sup-desc{margin-top:3px;color:#374151;font-size:.92rem;line-height:1.25;}

    .sup-cell-right{
      flex:0 0 auto;
      display:flex;
      align-items:center;
      gap:12px;
      white-space:nowrap;
    }

    .sup-price{font-weight:900;}
    .sup-controls{display:flex;gap:10px;align-items:center;}
    .sup-controls-disabled{opacity:.35;}

    .sup-qtysel{
      width:86px;
      padding:.45rem .55rem;
      border:1px solid #d1d5db;
      border-radius:.55rem;
      background: rgba(255,255,255,0.9);
    }

    @media (max-width: 860px){
      .sup-row-2col{grid-template-columns:1fr;}
      .sup-cell-empty{display:none;}
    }

    .sr-only{
      position:absolute!important;
      width:1px;height:1px;
      padding:0;margin:-1px;
      overflow:hidden;clip:rect(0,0,0,0);
      white-space:nowrap;border:0;
    }

    /* Modal */
    body.modal-open{overflow:hidden;}
    .modal{position:fixed;inset:0;display:none;z-index:9999;}
    .modal.open{display:block;}
    .modal-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.55);}
    .modal-card{
      position:relative;
      width:min(720px, calc(100% - 24px));
      margin:40px auto;
      background:#fff;
      border-radius:16px;
      box-shadow:0 20px 60px rgba(0,0,0,.25);
      overflow:hidden;
      border:1px solid rgba(0,0,0,.10);
    }
    .modal-head{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      padding:14px 16px;
      border-bottom:1px solid rgba(0,0,0,.08);
      background:#fafafa;
    }
    .modal-title{font-weight:900;font-size:16px;}
    .modal-sub{margin-top:4px;color:#374151;font-size:13px;}
    .modal-dot{margin:0 6px;color:#9ca3af;}
    .modal-tiny{margin-top:4px;color:#6b7280;font-size:12px;}
    .modal-body{padding:14px 16px;}
    .modal-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    .field{display:flex;flex-direction:column;gap:6px;font-size:13px;}
    .field span{color:#374151;font-weight:700;}
    .field input,.field textarea{padding:10px 10px;border:1px solid #d1d5db;border-radius:10px;font:inherit;}
    .field textarea{resize:vertical;}
    .field-full{grid-column:1 / -1;}
    .modal-actions{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-top:12px;
      padding-top:12px;
      border-top:1px solid rgba(0,0,0,.08);
    }
    .modal-status{color:#111;font-size:13px;min-height:18px;}
    .modal-buttons{display:flex;gap:10px;align-items:center;}
    .btn-ghost{background:transparent;border:0;padding:6px 8px;border-radius:10px;}
    .btn-outline{background:#fff;border:1px solid rgba(0,0,0,.18);}
    @media (max-width: 620px){
      .modal-grid{grid-template-columns:1fr;}
      .modal-card{margin:18px auto;}
    }
  </style>

  
  <!-- Request Price Modal -->
  <div id="quoteModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="quoteItemTitleLabel">
    <div class="modal-backdrop" data-modal="quoteModal"></div>
    <div class="modal-card">
      <div class="modal-head">
        <div>
          <div id="quoteItemTitleLabel" class="modal-title">Request Price</div>
          <div class="modal-sub">
            <span id="quoteItemTitle"></span>
            <span class="modal-dot">â€¢</span>
            <span id="quoteItemCategory"></span>
          </div>
          <div class="modal-tiny">Item ID: <span id="quoteItemId"></span></div>
        </div>
        <button class="btn btn-ghost" type="button" data-modal-close="quoteModal" aria-label="Close">âœ•</button>
      </div>

      <form id="quoteForm" class="modal-body">
        <div class="modal-grid">
          <label class="field">
            <span>Name</span>
            <input id="q_name" type="text" required />
          </label>
          <label class="field">
            <span>Email</span>
            <input id="q_email" type="email" required />
          </label>
          <label class="field">
            <span>Phone</span>
            <input id="q_phone" type="tel" required />
          </label>
          <label class="field">
            <span>Court Name</span>
            <input id="q_court" type="text" required />
          </label>
          <label class="field">
            <span>Court #</span>
            <input id="q_courtno" type="text" required />
          </label>
          <label class="field field-full">
            <span>Notes (optional)</span>
            <textarea id="q_notes" rows="3"></textarea>
          </label>
        </div>

        <div class="modal-actions">
          <div id="quoteStatus" class="modal-status" aria-live="polite"></div>
          <div class="modal-buttons">
            <button class="btn" type="button" data-modal-close="quoteModal">Cancel</button>
            <button class="btn btn-primary" type="submit">Send Request</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Extra Details Modal (for items that require Court info, e.g., SEALS) -->
  <div id="detailsModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="detailsTitleLabel">
    <div class="modal-backdrop" data-modal="detailsModal"></div>
    <div class="modal-card">
      <div class="modal-head">
        <div>
          <div id="detailsTitleLabel" class="modal-title">Item Details Required</div>
          <div class="modal-sub">
            <span id="detailsItemTitle"></span>
            <span class="modal-dot">â€¢</span>
            <span id="detailsItemCategory"></span>
          </div>
          <div class="modal-tiny">Item ID: <span id="detailsItemId"></span> â€¢ Price: <span id="detailsItemPrice"></span></div>
        </div>
        <button class="btn btn-ghost" type="button" data-modal-close="detailsModal" aria-label="Close">âœ•</button>
      </div>

      <form id="detailsForm" class="modal-body">
        <p class="muted" style="margin:0 0 10px;">
          When ordering a seal, please provide Court Name, Court #, Date Organized, and Location.
        </p>
        <div class="modal-grid">
          <label class="field">
            <span>Court Name</span>
            <input id="d_court" type="text" required />
          </label>
          <label class="field">
            <span>Court #</span>
            <input id="d_courtno" type="text" required />
          </label>
          <label class="field">
            <span>Date Organized</span>
            <input id="d_dateorg" type="text" placeholder="MM/DD/YYYY" required />
          </label>
          <label class="field">
            <span>Location</span>
            <input id="d_location" type="text" placeholder="City, State" required />
          </label>
        </div>

        <div class="modal-actions">
          <div id="detailsStatus" class="modal-status" aria-live="polite"></div>
          <div class="modal-buttons">
            <button class="btn" type="button" data-modal-close="detailsModal">Cancel</button>
            <button class="btn btn-primary" type="submit">Add to Order</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Maintenance check (match other pages) -->
  <script>
  (async () => {
    try {
      const resp = await fetch('/api/router?type=settings');
      const data = await resp.json();

      const on  = data?.effective?.MAINTENANCE_ON ?? data?.MAINTENANCE_ON;
      const msg = data?.effective?.MAINTENANCE_MESSAGE ?? data?.MAINTENANCE_MESSAGE;

      if (on === 'true' || on === true) {
        document.body.innerHTML = `
          <div style="display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;background:#fef2f2;color:#b91c1c;font-family:sans-serif;text-align:center;padding:20px">
            <h1 style="font-size:2em;margin-bottom:12px;">ðŸ›  Under Maintenance</h1>
            <p style="font-size:1.2em;max-width:500px;">
              ${msg || 'The site is temporarily unavailable. Please check back soon.'}
            </p>
          </div>
        `;
      }
    } catch (err) {
      console.error('Maintenance check failed:', err);
    }
  })();
  </script>

</body>
</html>
